<html lang="en">
<head>
<link rel="stylesheet" href="style.css" />
<link rel="icon" href="favicon.png" />
<script src="src/Raffle.js"></script>
<script src="src/NSI.js"></script>

<script src="src/UIUtils.js"></script>
<script src="src/Graph.js"></script>
<script src="src/RaffleSelectUI.js"></script>
<script src="src/ProbabilityUI.js"></script>
<script src="src/InvestmentUI.js"></script>
<title>Raffle Predictor</title>
<script>

window.addEventListener('load', () => {
	Raffle.set_engine(new Raffle.SharedWebWorkerEngine({workers: 8}));

	function to_apr(ratio, months) {
		return Math.pow(1 + ratio, 12 / months) - 1;
	}

	const markers = [
		{name: 'Averages'},
		{col: '#0033CC', name: 'Mean', scale: to_apr, value: (r) => r.mean()},
		{col: '#0077AA', name: 'Median', value: (r) => r.median()},
		{col: '#009900', name: 'Mode', value: (r) => r.mode()},

		{name: 'Percentiles'},
		{col: '#CCAA66', name: '25th', value: (r) => r.percentile(25)},
		{col: '#AA66FF', name: '75th', value: (r) => r.percentile(75)},
		{col: '#CC6666', name: '95th', value: (r) => r.percentile(95)},
	];

	const currencyCode = 'GBP';
	const maxTickets = 50000;
	const ticketCost = 1;

	const raffleSelectUI = new RaffleSelectUI({currencyCode});
	const probabilityUI = new ProbabilityUI({
		GraphClass: Graph,
		currencyCode,
		defaultTickets: 10000,
		graphLimit: 10000,
		markers,
		maxTickets,
		ticketCost,
	});
	const investmentUI = new InvestmentUI({
		GraphClass: Graph,
		currencyCode,
		markers,
		maxTickets,
		minTickets: 100,
		stepTickets: 100,
		ticketCost,
	});

	raffleSelectUI.set_callback((raffle) => {
		probabilityUI.set_raffle(raffle);
		investmentUI.set_raffle(raffle);
	});

	raffleSelectUI.add_loader('Load latest prizes from NS&I', () =>
		NSI.load().then(({last, next}) => {
			raffleSelectUI.add(
				'Previous NS&I Raffle',
				Raffle.from(last, {pCutoff: 1e-10})
			);
			raffleSelectUI.select(raffleSelectUI.add(
				'Predicted Next NS&I Raffle',
				Raffle.from(next, {pCutoff: 1e-10})
			));
		})
	);

	raffleSelectUI.add(
		'NS&I Premium Bonds Snapshot used by MSE',
		Raffle.from(new NSI([
			{value: 1000000, count:       2},
			{value:  100000, count:       4},
			{value:   50000, count:      10},
			{value:   25000, count:      17},
			{value:   10000, count:      43},
			{value:    5000, count:      87},
			{value:    1000, count:    1677},
			{value:     500, count:    5031},
			{value:     100, count:   22984},
			{value:      50, count:   22984},
			{value:      25, count: 2879959},
			{value:       0, count: 71850560383},
		]), {pCutoff: 1e-10})
	);

	raffleSelectUI.select(raffleSelectUI.add(
		'NS&I Premium Bonds Snapshot (March 2018)',
		Raffle.from(new NSI([
			{value: 1000000, count:       2},
			{value:  100000, count:       5},
			{value:   50000, count:       8},
			{value:   25000, count:      19},
			{value:   10000, count:      46},
			{value:    5000, count:      92},
			{value:    1000, count:    1717},
			{value:     500, count:    5151},
			{value:     100, count:   23554},
			{value:      50, count:   23554},
			{value:      25, count: 2950583},
		], {audienceMultiplier: 24500}), {pCutoff: 1e-10})
	));

	document.body.appendChild(raffleSelectUI.dom());
	document.body.appendChild(investmentUI.dom());
	document.body.appendChild(probabilityUI.dom());
});
</script>
</head>
<body>
<section class="info">
<h1>Raffle Predictor</h1>
<p>
This tool calculates odds of winning various prizes in a monetary raffle.
It is designed specifically to calculate
<a href="https://www.nsandi.com/premium-bonds" target="_blank">NS&amp;I Premium
Bonds</a>, but will work with any similar scheme.
</p>
<p>
For full details,
<a href="https://github.com/davidje13/Raffle" target="_blank">see the project
on GitHub</a>.
</p>
</section>
</body>
</html>
