<html lang="en">
<head>
<style>
body {
	font: 1em monospace;
	line-height: 1.4;
}
.head {
	font-weight: bolder;
}
</style>
<script src="src/Raffle.js"></script>
<script>
function add_message(m, cls = '') {
	const t = document.createTextNode(m);
	const d = document.createElement('div');
	d.appendChild(t);
	d.setAttribute('class', cls);
	document.body.appendChild(d);
	return d;
}

function money(v) {
	return '\u00A3' + v.toFixed(2);
}

window.addEventListener('load', () => {
	// NS&I premium bonds
	const prizes = [
		{value: 1000000, count:       2},
		{value:  100000, count:       5},
		{value:   50000, count:       8},
		{value:   25000, count:      19},
		{value:   10000, count:      46},
		{value:    5000, count:      92},
		{value:    1000, count:    1717},
		{value:     500, count:    5151},
		{value:     100, count:   23554},
		{value:      50, count:   23554},
		{value:      25, count: 2950583},
	];
	const fixedOdds = 24500; // 1 in x
	const raffle = new Raffle({
		audience: prizes.reduce((a, {count}) => a + count, 0) * fixedOdds,
		prizes,
		pCutoff: 1e-10,
	});

	const games = [];
	for(let i = 1000; i <= 50000; i += 1000) {
		games.push(raffle.enter(i));
	}

	add_message('Calculating for audience of ' + raffle.audience() + '\u2026');

	Promise.all(games).then((allResults) => {
		for(const results of allResults) {
			add_message('Tickets: ' + results.tickets(), 'head');
			add_message(
				'Percentiles: '
				+ '0th = ' + money(results.percentile(0)) + ', '
				+ '25th = ' + money(results.percentile(25)) + ', '
				+ 'median = ' + money(results.median()) + ', '
				+ '75th = ' + money(results.percentile(75)) + ', '
				+ '100th = ' + money(results.percentile(100))
			);
		}

		const results = allResults[allResults.length - 1];
		add_message('Breakdown for tickets: ' + results.tickets(), 'head');
		for(let i = results.min_value(); i <= results.max_value(); ++ i) {
			const pE = results.exact_probability(i);
			if(pE < 0.00000001) {
				continue;
			}
			const pR = results.range_probability(i, Number.POSITIVE_INFINITY);
			add_message(
				'= ' + money(i) + ': ' +
				(pE * 100).toFixed(4) + '%' +
				' >= ' + money(i) + ': ' +
				(pR * 100).toFixed(4) + '%'
			);
		}
	});
});
</script>
</head>
<body>
</body>
</html>
